"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9599],{3905:function(e,t,o){o.d(t,{Zo:function(){return d},kt:function(){return f}});var n=o(7294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)o=i[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var s=n.createContext({}),c=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},d=function(e){var t=c(e.components);return n.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),p=c(o),f=r,m=p["".concat(s,".").concat(f)]||p[f]||u[f]||i;return o?n.createElement(m,a(a({ref:t},d),{},{components:o})):n.createElement(m,a({ref:t},d))}));function f(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=o.length,a=new Array(i);a[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,a[1]=l;for(var c=2;c<i;c++)a[c]=o[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,o)}p.displayName="MDXCreateElement"},9534:function(e,t,o){o.r(t),o.d(t,{assets:function(){return d},contentTitle:function(){return s},default:function(){return f},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return u}});var n=o(7462),r=o(3366),i=(o(7294),o(3905)),a=["components"],l={sidebar_position:61},s="Force Deletion",c={unversionedId:"execution/job/force-deletion",id:"execution/job/force-deletion",title:"Force Deletion",description:"This page describes when and how force deletion is used in the JobController.",source:"@site/docs/execution/job/force-deletion.md",sourceDirName:"execution/job",slug:"/execution/job/force-deletion",permalink:"/docs/execution/job/force-deletion",draft:!1,editUrl:"https://github.com/furiko-io/website/tree/main/docs/execution/job/force-deletion.md",tags:[],version:"current",sidebarPosition:61,frontMatter:{sidebar_position:61},sidebar:"tutorialSidebar",previous:{title:"Killing Jobs",permalink:"/docs/execution/job/killing-jobs"},next:{title:"Garbage Collection",permalink:"/docs/execution/job/garbage-collection"}},d={},u=[{value:"Motivation",id:"motivation",level:2},{value:"Deletion Process",id:"deletion-process",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Task: <code>forbidTaskForceDeletion</code>",id:"task-forbidtaskforcedeletion",level:3},{value:"Global: <code>forceDeleteTaskTimeoutSeconds</code>",id:"global-forcedeletetasktimeoutseconds",level:3}],p={toc:u};function f(e){var t=e.components,o=(0,r.Z)(e,a);return(0,i.kt)("wrapper",(0,n.Z)({},p,o,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"force-deletion"},"Force Deletion"),(0,i.kt)("p",null,"This page describes when and how ",(0,i.kt)("strong",{parentName:"p"},"force deletion")," is used in the JobController."),(0,i.kt)("h2",{id:"motivation"},"Motivation"),(0,i.kt)("p",null,"When ",(0,i.kt)("a",{parentName:"p",href:"/docs/execution/job/killing-jobs"},"killing a Job"),", the controller first attempts to use normal deletion to gracefully terminate the task."),(0,i.kt)("p",null,"However, if the node is not responsive (e.g. kubelet is not running, unreachable via network, etc.), such deletion may not be effective, since Kubernetes ensures that the Pod will not be deleted until it has confirmed that the container is fully removed and cleaned up on the node itself."),(0,i.kt)("p",null,"If the JobConfig uses a concurrency policy like ",(0,i.kt)("inlineCode",{parentName:"p"},"Forbid"),", this may ",(0,i.kt)("strong",{parentName:"p"},"indefinitely block future progress"),' of the JobConfig from creating and starting new Jobs. As such, Furiko supports "force deletion" as a last resort, which forcefully deletes the Pod, allowing the Job to be terminated in order for the JobConfig to schedule new Jobs.'),(0,i.kt)("h2",{id:"deletion-process"},"Deletion Process"),(0,i.kt)("p",null,'The "force deletion" process is analogous to simply running:'),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"kubectl delete pod <pod name> --grace-period=0 --force\n")),(0,i.kt)("p",null,"For more information, see ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-termination-forced"},"Forced Pod termination")," on the Kubernetes documentation."),(0,i.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"The ",(0,i.kt)("a",{parentName:"p",href:"https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands#delete"},"official Kubernetes official documentation")," mentions the following warning about force deletion (emphasis added):"),(0,i.kt)("blockquote",{parentName:"div"},(0,i.kt)("p",{parentName:"blockquote"},"IMPORTANT: Force deleting pods does not wait for confirmation that the pod's processes have been terminated, which ",(0,i.kt)("strong",{parentName:"p"},"can leave those processes running until the node detects the deletion and completes graceful deletion"),". If your processes use shared storage or talk to a remote API and depend on the name of the pod to identify themselves, force deleting those pods ",(0,i.kt)("strong",{parentName:"p"},"may result in multiple processes running on different machines using the same identification which may lead to data corruption or inconsistency"),". Only force delete pods when you are sure the pod is terminated, or if your application can tolerate multiple copies of the same pod running at once. Also, if you force delete pods the scheduler may place new pods on those nodes before the node has released those resources and causing those pods to be evicted immediately.")))),(0,i.kt)("p",null,"Typically when running cron jobs, force deletion is safe most of the time, and in most cases would prefer availability of scheduling over strict guarantees. However, for jobs that are more crucial, they may choose to disable this functionality and instead trigger notifications to investigate node-level issues."),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("h3",{id:"task-forbidtaskforcedeletion"},"Task: ",(0,i.kt)("inlineCode",{parentName:"h3"},"forbidTaskForceDeletion")),(0,i.kt)("p",null,"You can prevent force deletion by specifying ",(0,i.kt)("inlineCode",{parentName:"p"},"forbidTaskForceDeletion: true")," in the JobTaskSpec, as follows:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"apiVersion: execution.furiko.io/v1alpha1\nkind: Job\nspec:\n  template:\n    # The normal task template\n    taskTemplate: ...\n\n    # Forbids force deletion of the task.\n    forbidTaskForceDeletion: true\n")),(0,i.kt)("p",null,"In such a scenario, the controller will simply just wait until the Pod transitions into a terminated state before marking the Job as terminated as well."),(0,i.kt)("h3",{id:"global-forcedeletetasktimeoutseconds"},"Global: ",(0,i.kt)("inlineCode",{parentName:"h3"},"forceDeleteTaskTimeoutSeconds")),(0,i.kt)("p",null,"Specifies the default duration that the controller should wait after the ",(0,i.kt)("inlineCode",{parentName:"p"},"deletionTimestamp")," of a task before forcefully deleting the task. Set to 0 to disable force deletion globally."),(0,i.kt)("p",null,"For more information, see the ",(0,i.kt)("a",{parentName:"p",href:"/docs/reference/configuration/execution/dynamic-config#forcedeletetasktimeoutseconds"},"Execution Dynamic Config")," documentation."))}f.isMDXComponent=!0}}]);