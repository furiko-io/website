"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1203],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return h}});var o=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,i=function(e,n){if(null==e)return{};var t,o,i={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=o.createContext({}),d=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},c=function(e){var n=d(e.components);return o.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},f=o.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),f=d(t),h=i,m=f["".concat(l,".").concat(h)]||f[h]||u[h]||a;return t?o.createElement(m,r(r({ref:n},c),{},{components:t})):o.createElement(m,r({ref:n},c))}));function h(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,r=new Array(a);r[0]=f;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var d=2;d<a;d++)r[d]=t[d];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}f.displayName="MDXCreateElement"},3284:function(e,n,t){t.r(n),t.d(n,{assets:function(){return c},contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return u}});var o=t(7462),i=t(3366),a=(t(7294),t(3905)),r=["components"],s={sidebar_position:30,sidebar_label:"Dynamic Config"},l="Execution Dynamic Config",d={unversionedId:"reference/configuration/execution/dynamic-config",id:"version-v0.2.1/reference/configuration/execution/dynamic-config",title:"Execution Dynamic Config",description:"This page documents the dynamic configuration for all execution components.",source:"@site/versioned_docs/version-v0.2.1/reference/configuration/execution/dynamic-config.md",sourceDirName:"reference/configuration/execution",slug:"/reference/configuration/execution/dynamic-config",permalink:"/docs/reference/configuration/execution/dynamic-config",draft:!1,editUrl:"https://github.com/furiko-io/website/tree/main/versioned_docs/version-v0.2.1/reference/configuration/execution/dynamic-config.md",tags:[],version:"v0.2.1",sidebarPosition:30,frontMatter:{sidebar_position:30,sidebar_label:"Dynamic Config"},sidebar:"tutorialSidebar",previous:{title:"Webhook Config",permalink:"/docs/reference/configuration/execution/webhook-config"}},c={},u=[{value:"Configuration Options",id:"configuration-options",level:2},{value:"<code>jobs</code>",id:"jobs",level:3},{value:"<code>defaultTTLSecondsAfterFinished</code>",id:"defaultttlsecondsafterfinished",level:4},{value:"<code>defaultPendingTimeoutSeconds</code>",id:"defaultpendingtimeoutseconds",level:4},{value:"<code>forceDeleteTaskTimeoutSeconds</code>",id:"forcedeletetasktimeoutseconds",level:4},{value:"<code>jobConfigs</code>",id:"jobconfigs",level:3},{value:"<code>maxEnqueuedJobs</code>",id:"maxenqueuedjobs",level:4},{value:"<code>cron</code>",id:"cron",level:3},{value:"<code>cronFormat</code>",id:"cronformat",level:4},{value:"<code>cronHashNames</code>",id:"cronhashnames",level:4},{value:"<code>cronHashSecondsByDefault</code>",id:"cronhashsecondsbydefault",level:4},{value:"<code>cronHashFields</code>",id:"cronhashfields",level:4},{value:"<code>defaultTimezone</code>",id:"defaulttimezone",level:4},{value:"<code>maxMissedSchedules</code>",id:"maxmissedschedules",level:4},{value:"<code>maxDowntimeThresholdSeconds</code>",id:"maxdowntimethresholdseconds",level:4},{value:"Sample Configuration",id:"sample-configuration",level:2}],f={toc:u};function h(e){var n=e.components,t=(0,i.Z)(e,r);return(0,a.kt)("wrapper",(0,o.Z)({},f,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"execution-dynamic-config"},"Execution Dynamic Config"),(0,a.kt)("p",null,"This page documents the ",(0,a.kt)("a",{parentName:"p",href:"/docs/operator-manual/configuration/dynamic"},"dynamic configuration")," for all execution components."),(0,a.kt)("h2",{id:"configuration-options"},"Configuration Options"),(0,a.kt)("p",null,"Each of the following sections corresponds to a single key in the dynamic configuration ConfigMap."),(0,a.kt)("h3",{id:"jobs"},(0,a.kt)("inlineCode",{parentName:"h3"},"jobs")),(0,a.kt)("p",null,"Defines configuration for ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/job/"},"Jobs"),"."),(0,a.kt)("h4",{id:"defaultttlsecondsafterfinished"},(0,a.kt)("inlineCode",{parentName:"h4"},"defaultTTLSecondsAfterFinished")),(0,a.kt)("p",null,"Defines the default value of ",(0,a.kt)("inlineCode",{parentName:"p"},"ttlSecondsAfterFinished")," for a Job if it is not defined. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/job/garbage-collection"},"Garbage Collection"),"."),(0,a.kt)("p",null,"To avoid issues with huge amounts of finished Jobs building up, a non-zero TTL is enforced."),(0,a.kt)("p",null,"Defaults to 3600 (1 hour)."),(0,a.kt)("h4",{id:"defaultpendingtimeoutseconds"},(0,a.kt)("inlineCode",{parentName:"h4"},"defaultPendingTimeoutSeconds")),(0,a.kt)("p",null,"Defines the default value of ",(0,a.kt)("inlineCode",{parentName:"p"},"pendingTimeoutSeconds")," for a Job if it is not defined. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/job/timeout-retries#pendingtimeoutseconds"},"Pending Timeouts"),"."),(0,a.kt)("p",null,"Defaults to 900 (15 minutes)."),(0,a.kt)("h4",{id:"forcedeletetasktimeoutseconds"},(0,a.kt)("inlineCode",{parentName:"h4"},"forceDeleteTaskTimeoutSeconds")),(0,a.kt)("p",null,"The duration before the controller uses force deletion instead of normal deletion. This timeout is computed from the deletionTimestamp of the object, which may also include an additional delay of ",(0,a.kt)("inlineCode",{parentName:"p"},"deletionGracePeriodSeconds"),". For more information, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/job/force-deletion"},"Force Deletion"),"."),(0,a.kt)("p",null,"Force deletion causes the task to be deleted without confirmation that the task has already terminated. When ",(0,a.kt)("inlineCode",{parentName:"p"},"pod")," is used for taskTemplate, this means that the container may remain running on the node even though the task or Job is already marked as terminated."),(0,a.kt)("p",null,"Set this value to 0 to disable force deletion globally. Individual jobs can also specify spec.forbidTaskForceDeletion in the JobTemplate to disable force deletion if this behavior is not desired."),(0,a.kt)("p",null,"Defaults to 900 (15 minutes)."),(0,a.kt)("h3",{id:"jobconfigs"},(0,a.kt)("inlineCode",{parentName:"h3"},"jobConfigs")),(0,a.kt)("p",null,"Defines configuration for ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/jobconfig/"},"JobConfigs"),"."),(0,a.kt)("h4",{id:"maxenqueuedjobs"},(0,a.kt)("inlineCode",{parentName:"h4"},"maxEnqueuedJobs")),(0,a.kt)("p",null,"The global maximum enqueued jobs that can be enqueued for a single JobConfig."),(0,a.kt)("p",null,"Defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"20"),"."),(0,a.kt)("h3",{id:"cron"},(0,a.kt)("inlineCode",{parentName:"h3"},"cron")),(0,a.kt)("p",null,"Defines configuration for ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/jobconfig/cron-syntax"},"parsing cron expressions")," within the cluster."),(0,a.kt)("h4",{id:"cronformat"},(0,a.kt)("inlineCode",{parentName:"h4"},"cronFormat")),(0,a.kt)("p",null,"Specifies the format used to parse cron expressions. The only difference is in the ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/jobconfig/cron-syntax#day-of-week"},"Day of Week digit parsing"),"."),(0,a.kt)("p",null,"Only the following values are supported:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"standard")," (default): Standard cron format."),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("inlineCode",{parentName:"li"},"quartz"),": ",(0,a.kt)("a",{parentName:"li",href:"http://www.quartz-scheduler.org/documentation/quartz-2.3.0/tutorials/crontrigger.html"},"Quartz")," cron format.")),(0,a.kt)("h4",{id:"cronhashnames"},(0,a.kt)("inlineCode",{parentName:"h4"},"cronHashNames")),(0,a.kt)("p",null,"Specifies if cron expressions should be hashed using the JobConfig's name. Enabling this option would ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/jobconfig/cron-syntax#hash-based-load-balancing"},"allow ",(0,a.kt)("inlineCode",{parentName:"a"},"H")," tokens to be used"),". If disabled, any JobConfigs that use the ",(0,a.kt)("inlineCode",{parentName:"p"},"H")," syntax will throw a parse error."),(0,a.kt)("p",null,"Defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,a.kt)("h4",{id:"cronhashsecondsbydefault"},(0,a.kt)("inlineCode",{parentName:"h4"},"cronHashSecondsByDefault")),(0,a.kt)("p",null,"Specifies if the seconds field of a cron expression should be a ",(0,a.kt)("inlineCode",{parentName:"p"},"H")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"0")," by default if omitted. If enabled, the default seconds field will be ",(0,a.kt)("inlineCode",{parentName:"p"},"H"),", otherwise it will be ",(0,a.kt)("inlineCode",{parentName:"p"},"0"),"."),(0,a.kt)("p",null,"For JobConfigs which use a short cron expression format (i.e. 5 or 6 tokens long), the seconds field is omitted and is typically assumed to be ",(0,a.kt)("inlineCode",{parentName:"p"},"0")," (e.g. ",(0,a.kt)("inlineCode",{parentName:"p"},"5 10 * * *")," means to run at 10:05:00 every day). Enabling this option will allow JobConfigs to be scheduled across the minute, improving load balancing."),(0,a.kt)("p",null,"Users can still choose to start at 0 seconds by explicitly specifying a long cron expression format with ",(0,a.kt)("inlineCode",{parentName:"p"},"0")," in the seconds field. In the above example, this would be ",(0,a.kt)("inlineCode",{parentName:"p"},"0 5 10 * * * *"),"."),(0,a.kt)("p",null,"Defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,a.kt)("h4",{id:"cronhashfields"},(0,a.kt)("inlineCode",{parentName:"h4"},"cronHashFields")),(0,a.kt)("p",null,'Specifies if the "type of field" should be hashed along with the JobConfig\'s name.'),(0,a.kt)("p",null,"For example, ",(0,a.kt)("inlineCode",{parentName:"p"},"H H * * * * *")," will always hash the seconds and minutes to the same value, for example 00:37:37, 01:37:37, etc. Enabling this option will append additional keys to be hashed to introduce additional non-determinism."),(0,a.kt)("p",null,"Defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,a.kt)("h4",{id:"defaulttimezone"},(0,a.kt)("inlineCode",{parentName:"h4"},"defaultTimezone")),(0,a.kt)("p",null,"Defines a default timezone to use for JobConfigs that do not specify a ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/jobconfig/scheduling#crontimezone"},"timezone"),"."),(0,a.kt)("p",null,"Defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"UTC"),"."),(0,a.kt)("h4",{id:"maxmissedschedules"},(0,a.kt)("inlineCode",{parentName:"h4"},"maxMissedSchedules")),(0,a.kt)("p",null,"Defines a maximum number of jobs that the controller should back-schedule, or attempt to create after coming back up from downtime. Having a sane value here would prevent a thundering herd of jobs being scheduled that would exhaust resources in the cluster. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/jobconfig/scheduling#back-scheduling"},"Back-Scheduling"),"."),(0,a.kt)("p",null,"In practice, setting this to too high of a value could result in accidental resource exhaustion in the cluster if the controller was intentionally shut down for an extended period of time."),(0,a.kt)("p",null,"Set this to 0 to disable back-scheduling entirely. Defaults to 5."),(0,a.kt)("h4",{id:"maxdowntimethresholdseconds"},(0,a.kt)("inlineCode",{parentName:"h4"},"maxDowntimeThresholdSeconds")),(0,a.kt)("p",null,"Defines the maximum downtime that the controller can tolerate. If the controller was intentionally shut down for an extended period of time, we should not attempt to back-schedule jobs once it was started. For more information, see ",(0,a.kt)("a",{parentName:"p",href:"/docs/execution/jobconfig/scheduling#back-scheduling"},"Back-Scheduling"),"."),(0,a.kt)("p",null,"In practice, setting this to too high of a value means that jobs could be ridiculously delayed when they are better off being skipped entirely (say, sending out a end-of-week report on the following Monday instead)."),(0,a.kt)("p",null,"Defaults to ",(0,a.kt)("inlineCode",{parentName:"p"},"300")," (5 minutes). It is recommended to tune this to the maximum realistic outage duration of the controller."),(0,a.kt)("h2",{id:"sample-configuration"},"Sample Configuration"),(0,a.kt)("p",null,"The following sample shows how to configure the full dynamic configuration ConfigMap of the execution component, as well as the default configuration values for each field."),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Full Sample Configuration"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yaml"},'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: execution-dynamic-config\n  namespace: furiko-system\ndata:\n  _readme: |\n    # This ConfigMap contains the dynamic config for execution-controller.\n    # We can tune several knobs in execution-controller without requiring a restart.\n    # Each file in this ConfigMap groups together configuration of a single sub-component.\n    # As a start, we have populated a set of sane default values for you.\n    # More info: https://furiko.io/reference/configuration/dynamic/\n\n  jobs: |\n    apiVersion: config.furiko.io/v1alpha1\n    kind: JobExecutionConfig\n\n    # The default time-to-live (TTL) for a Job after it has finished. Lower this\n    # value to reduce the strain on the cluster/kubelet. Set to 0 to delete immediately\n    # after the Job is finished.\n    defaultTTLSecondsAfterFinished: 3600\n\n    # The default timeout for a task to remain in a pending state. Defaults to 15 minutes\n    # in order to prevent jobs from retrying indefinitely.\n    #\n    # To prevent setting a default pending timeout globally, set this to 0. Individual jobs\n    # can still specify spec.taskPendingTimeoutSeconds in the JobTemplate to override this\n    # global default value.\n    defaultPendingTimeoutSeconds: 900\n\n    # The duration before the controller uses force deletion instead of normal deletion.\n    # This timeout is computed from the deletionTimestamp of the object, which may also include\n    # an additional delay of deletionGracePeriodSeconds.\n    #\n    # Force deletion causes the task to be deleted without confirmation that the task has already\n    # terminated. When pod is used for taskTemplate, this means that\n    #\n    # Set this value to 0 to disable force deletion globally. Individual jobs can also specify\n    # spec.forbidTaskForceDeletion in the JobTemplate to disable force deletion if this\n    # behavior is not desired.\n    forceDeleteTaskTimeoutSeconds: 900\n\n  jobConfigs: |\n    apiVersion: config.furiko.io/v1alpha1\n    kind: JobConfigExecutionConfig\n\n    # The global maximum enqueued jobs that can be enqueued for a single JobConfig.\n    maxEnqueuedJobs: 20\n\n  cron: |\n    apiVersion: config.furiko.io/v1alpha1\n    kind: CronExecutionConfig\n\n    # Specifies the format used to parse cron expressions. Select between "standard"\n    # (default) or "quartz".\n    cronFormat: "standard"\n\n    # Specifies if cron expressions should be hashed using the JobConfig\'s name.\n    #\n    # This enables "hash cron expressions", which looks like `0 H * * *`. This\n    # particular example means to run once a day on the 0th minute of some hour,\n    # which will be determined by hashing the JobConfig\'s name. By enabling this\n    # option, JobConfigs that use such cron schedules will be load balanced across\n    # the cluster.\n    #\n    # If disabled, any JobConfigs that use the `H` syntax will throw a parse error.\n    cronHashNames: true\n\n    # Specifies if the seconds field of a cron expression should be a `H` or `0`\n    # by default. If enabled, it will be `H`, otherwise it will default to `0`.\n    #\n    # For JobConfigs which use a short cron expression format (i.e. 5 or 6 tokens\n    # long), the seconds field is omitted and is typically assumed to be `0` (e.g.\n    # `5 10 * * *` means to run at 10:05:00 every day). Enabling this option will\n    # allow JobConfigs to be scheduled across the minute, improving load balancing.\n    #\n    # Users can still choose to start at 0 seconds by explicitly specifying a long\n    # cron expression format with `0` in the seconds field. In the above example,\n    # this would be `0 5 10 * * * *`.\n    cronHashSecondsByDefault: false\n\n    # Specifies if the fields should be hashed along with the JobConfig\'s name.\n    #\n    # For example, `H H * * * * *` will always hash the seconds and minutes to the\n    # same value, for example 00:37:37, 01:37:37, etc. Enabling this option will\n    # append additional keys to be hashed to introduce additional non-determinism.\n    cronHashFields: true\n\n    # Defines a default timezone to use for JobConfigs that do not specify a timezone.\n    # If left empty, UTC will be used as the default timezone.\n    defaultTimezone: "UTC"\n\n    # Defines the maximum number of jobs that the controller should back-schedule,\n    # or attempt to create after coming back up from downtime. Having a sane value\n    # here would prevent a thundering herd of jobs being scheduled that would exhaust\n    # resources in the cluster.\n    #\n    # Set this to 0 to disable back-scheduling.\n    maxMissedSchedules: 5\n\n    # Defines the maximum downtime that the controller can tolerate. If the controller\n    # was shut down for an extended period of time, any jobs that should have been created\n    # beyond the maximum downtime threshold would not be back-scheduled once it is started again.\n    maxDowntimeThresholdSeconds: 300\n'))))}h.isMDXComponent=!0}}]);